<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark" title="GrooveShark" viewActivate="view1_viewActivateHandler(event)" destructionPolicy="never">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import com.adobe.serialization.json.JSON;
			
			import mx.collections.ArrayCollection;
			
			import spark.events.IndexChangeEvent;
			import spark.events.ViewNavigatorEvent;
			
			private var loader:URLLoader;
			[Bindable]
			private var arrcoll:ArrayCollection;
			
			protected function view1_viewActivateHandler(event:ViewNavigatorEvent):void
			{
				// TODO Auto-generated method stub
				//navigator.pushView(views.GrooveSharkPlayer);
			}
			
			protected function button1_clickHandler(event:MouseEvent):void
			{
				loader = new URLLoader();
				configureListeners(loader);
				var reqStr:String = "http://tinysong.com/s/" + searchTerms.text+"?format=json&limit=10&key=d5d5997eea496a07922e003f547d1659";
				var request:URLRequest = new URLRequest(reqStr);
				loader.load(request);
				
			}
			
			private function configureListeners(dispatcher:IEventDispatcher):void {
				dispatcher.addEventListener(Event.COMPLETE, completeHandler);
				dispatcher.addEventListener(Event.OPEN, openHandler);
				dispatcher.addEventListener(ProgressEvent.PROGRESS, progressHandler);
				dispatcher.addEventListener(SecurityErrorEvent.SECURITY_ERROR, securityErrorHandler);
				dispatcher.addEventListener(HTTPStatusEvent.HTTP_STATUS, httpStatusHandler);
				dispatcher.addEventListener(IOErrorEvent.IO_ERROR, ioErrorHandler);
			}
			
			private function completeHandler(event:Event):void {
				var arr:Array = (JSON.decode(loader.data) as Array);
				arrcoll = new ArrayCollection(arr);
			}
			
			private function openHandler(event:Event):void {
				trace("openHandler: " + event);
			}
			
			private function progressHandler(event:ProgressEvent):void {
				trace("progressHandler loaded:" + event.bytesLoaded + " total: " + event.bytesTotal);
			}
			
			private function securityErrorHandler(event:SecurityErrorEvent):void {
				trace("securityErrorHandler: " + event);
			}
			
			private function httpStatusHandler(event:HTTPStatusEvent):void {
				trace("httpStatusHandler: " + event);
			}
			
			private function ioErrorHandler(event:IOErrorEvent):void {
				trace("ioErrorHandler: " + event);
			}
			
			protected function itemsList_changeHandler(event:IndexChangeEvent):void
			{
				// TODO Auto-generated method stub
				navigator.pushView(views.GrooveSharkPlayer, itemsList.selectedItem.SongID);
			}
			
		]]>
	</fx:Script>
	<s:TextInput id="searchTerms" width="268" height="44" maxChars="30"
				 restrict="A-Z a-z 012345689" text="Search"/>
	<s:Button x="5" y="54" label="Search" click="button1_clickHandler(event)" />
	<s:List id="itemsList" x="10" y="167" width="460" height="292"
			dataProvider="{arrcoll}"
			itemRenderer="views.GrooveSharkThumbnail" change="itemsList_changeHandler(event)" />
</s:View>
